let items = [];
let selectedItems = [];
let tables = [];
let orders = [];
let currentTable = null;

// ุฏุงูุฉ ุงูุฅุดุนุงุฑุงุช ุงูุฃูููุฉ
function showNotification(message, type = 'success') {
  const backgroundColor = type === 'success' ? '#2ecc71' : 
                         type === 'error' ? '#e74c3c' : 
                         type === 'warning' ? '#f39c12' : '#3498db';
  
  Toastify({
    text: message,
    duration: 3000,
    gravity: "top",
    position: "right",
    backgroundColor: backgroundColor,
    stopOnFocus: true,
    style: {
      fontFamily: 'Segoe UI, sans-serif',
      fontSize: '16px',
      borderRadius: '8px',
      padding: '12px 20px'
    }
  }).showToast();
}

// ุชุญููู ุงูุจูุงูุงุช ุงููุญููุธุฉ ุนูุฏ ุจุฏุก ุงูุชุทุจูู
window.onload = function() {
  console.log("ุจุฏุก ุชุญููู ุงูุชุทุจูู...");
  loadAllData();
  console.log("ุชู ุชุญููู ุงูุจูุงูุงุช. ุนุฏุฏ ุงูุทุงููุงุช:", tables.length);
  checkIfCustomerView();
  checkConnectionStatus();
  console.log("ุงูุชูู ุชุญููู ุงูุชุทุจูู");
};

// ูุญุต ุญุงูุฉ ุงูุงุชุตุงู
function checkConnectionStatus() {
  if (!navigator.onLine) {
    showNotification("ุฃูุช ุชุนูู ุจุฏูู ุฅูุชุฑูุช. ุงูุจูุงูุงุช ูุญููุธุฉ ูุญููุงู.", "warning");
  }
  
  window.addEventListener('online', function() {
    showNotification("ุชู ุงุณุชุนุงุฏุฉ ุงูุงุชุตุงู ุจุงูุฅูุชุฑูุช!", "success");
  });
  
  window.addEventListener('offline', function() {
    showNotification("ุงููุทุน ุงูุงุชุตุงู ุจุงูุฅูุชุฑูุช. ููููู ุงูุงุณุชูุฑุงุฑ ูู ุงูุนูู.", "warning");
  });
  
  // ุญูุธ ุงูุจูุงูุงุช ุนูุฏ ุฅุบูุงู ุงูุตูุญุฉ
  window.addEventListener('beforeunload', function() {
    saveAllData();
  });
  
  // ุญูุธ ุงูุจูุงูุงุช ูู ุฏูููุฉ
  setInterval(() => {
    saveAllData();
  }, 60000);
}

// ุญูุธ ุฌููุน ุงูุจูุงูุงุช ูู localStorage ู IndexedDB
function saveAllData() {
  localStorage.setItem('restaurantItems', JSON.stringify(items));
  localStorage.setItem('restaurantTables', JSON.stringify(tables));
  localStorage.setItem('restaurantOrders', JSON.stringify(orders));
  
  // ุญูุธ ูู IndexedDB ููุนูู ุจุฏูู ุฅูุชุฑูุช
  if ('indexedDB' in window) {
    const request = indexedDB.open('CaveRestaurantDB', 1);
    
    request.onupgradeneeded = function(event) {
      const db = event.target.result;
      
      // ุฅูุดุงุก ุฌุฏุงูู ุงูุจูุงูุงุช
      if (!db.objectStoreNames.contains('items')) {
        db.createObjectStore('items', { keyPath: 'id' });
      }
      if (!db.objectStoreNames.contains('tables')) {
        db.createObjectStore('tables', { keyPath: 'id' });
      }
      if (!db.objectStoreNames.contains('orders')) {
        db.createObjectStore('orders', { keyPath: 'id' });
      }
    };
    
    request.onsuccess = function(event) {
      const db = event.target.result;
      
      // ุญูุธ ุงูุฃุตูุงู
      const itemsStore = db.transaction(['items'], 'readwrite').objectStore('items');
      items.forEach(item => {
        itemsStore.put(item);
      });
      
      // ุญูุธ ุงูุทุงููุงุช
      const tablesStore = db.transaction(['tables'], 'readwrite').objectStore('tables');
      tables.forEach(table => {
        tablesStore.put(table);
      });
      
      // ุญูุธ ุงูุทูุจุงุช
      const ordersStore = db.transaction(['orders'], 'readwrite').objectStore('orders');
      orders.forEach(order => {
        ordersStore.put(order);
      });
    };
  }
}

// ุชุญููู ุฌููุน ุงูุจูุงูุงุช ูู localStorage ู IndexedDB
function loadAllData() {
  console.log("ุจุฏุก ุชุญููู ุงูุจูุงูุงุช...");
  const savedItems = localStorage.getItem('restaurantItems');
  const savedTables = localStorage.getItem('restaurantTables');
  const savedOrders = localStorage.getItem('restaurantOrders');
  
  console.log("ุงูุจูุงูุงุช ุงููุญููุธุฉ:", { savedItems: !!savedItems, savedTables: !!savedTables, savedOrders: !!savedOrders });
  
  if (savedItems) {
    items = JSON.parse(savedItems);
    console.log("ุชู ุชุญููู ุงูุฃุตูุงู:", items.length);
  }
  if (savedTables) {
    tables = JSON.parse(savedTables);
    console.log("ุชู ุชุญููู ุงูุทุงููุงุช ูู localStorage:", tables.length);
    // ุชุญุฏูุซ QR Codes ูุฌููุน ุงูุทุงููุงุช ูุถูุงู ุงูุฑุจุท ุงููุจุงุดุฑ
    tables.forEach(table => {
      table.qrCode = generateQRCode(table.id);
    });
  } else {
    console.log("ูู ูุชู ุงูุนุซูุฑ ุนูู ุทุงููุงุช ูุญููุธุฉุ ุณูุชู ุฅูุดุงุก ุทุงููุงุช ุงูุชุฑุงุถูุฉ");
    // ุฅูุดุงุก ุทุงููุงุช ุงูุชุฑุงุถูุฉ ุฅุฐุง ูู ุชูู ููุฌูุฏุฉ
    tables = [
      { id: 1, name: 'Table 1', qrCode: generateQRCode(1), active: false },
      { id: 2, name: 'Table 2', qrCode: generateQRCode(2), active: false },
      { id: 3, name: 'Table 3', qrCode: generateQRCode(3), active: false },
      { id: 4, name: 'Table 4', qrCode: generateQRCode(4), active: false },
      { id: 5, name: 'Table 5', qrCode: generateQRCode(5), active: false }
    ];
    console.log("ุชู ุฅูุดุงุก ุทุงููุงุช ุงูุชุฑุงุถูุฉ:", tables.length);
    saveAllData();
  }
  if (savedOrders) {
    orders = JSON.parse(savedOrders);
    console.log("ุชู ุชุญููู ุงูุทูุจุงุช:", orders.length);
  }
  
  // ุชุญููู ูู IndexedDB ุฅุฐุง ูุงู ูุชุงุญุงู
  if ('indexedDB' in window) {
    const request = indexedDB.open('CaveRestaurantDB', 1);
    
    request.onsuccess = function(event) {
      const db = event.target.result;
      
      // ุชุญููู ุงูุฃุตูุงู
      const itemsStore = db.transaction(['items'], 'readonly').objectStore('items');
      const itemsRequest = itemsStore.getAll();
      itemsRequest.onsuccess = function() {
        if (itemsRequest.result.length > 0) {
          items = itemsRequest.result;
        }
      };
      
      // ุชุญููู ุงูุทุงููุงุช
      const tablesStore = db.transaction(['tables'], 'readonly').objectStore('tables');
      const tablesRequest = tablesStore.getAll();
      tablesRequest.onsuccess = function() {
        if (tablesRequest.result.length > 0) {
          tables = tablesRequest.result;
        }
      };
      
      // ุชุญููู ุงูุทูุจุงุช
      const ordersStore = db.transaction(['orders'], 'readonly').objectStore('orders');
      const ordersRequest = ordersStore.getAll();
      ordersRequest.onsuccess = function() {
        if (ordersRequest.result.length > 0) {
          orders = ordersRequest.result;
        }
      };
    };
  }
}

// ุชูููุฏ QR code ููุทุงููุฉ - ูุฑุชุจุท ูุจุงุดุฑุฉ ุจูุงุฆูุฉ ุงูุฃุตูุงู ุงูุญุงููุฉ
function generateQRCode(tableId) {
  // ุฅูุดุงุก ุฑุงุจุท ุซุงุจุช ูุตูุญุฉ ุงูุทูุจ ุงููููุตูุฉ
  // ูุงุฆูุฉ ุงูุฃุตูุงู ุณุชูุญุฏุซ ุชููุงุฆูุงู ูู localStorage
  return `${window.location.origin}/order.html?table=${tableId}`;
}

// ุงูุชุญูู ูู ุฃู ุงููุณุชุฎุฏู ููุชุญ ุฑุงุจุท ุงูุทูุจ ูุฒุจูู
function checkIfCustomerView() {
  const urlParams = new URLSearchParams(window.location.search);
  const orderData = urlParams.get('order');
  const tableId = urlParams.get('table');
  
  if (tableId) {
    // ูุงุฌูุฉ ุงูุทูุจ ููุทุงููุฉ
    showTableCustomerInterface(parseInt(tableId));
  } else if (orderData) {
    try {
      const orderItems = JSON.parse(decodeURIComponent(orderData));
      showCustomerInterface(orderItems);
    } catch (e) {
      console.error('ุฎุทุฃ ูู ุชุญููู ุจูุงูุงุช ุงูุทูุจ:', e);
    }
  }
}

// ุงูุชุญูู ูู ูุงุฌูุฉ ุงููุทุจุฎ


// ุนุฑุถ ูุงุฌูุฉ ุฅุถุงูุฉ ุตูู ุฌุฏูุฏ
function showAddItemForm() {
  const content = document.getElementById("main-content");
  content.innerHTML = `
    <h2>Sardecoffeshop</h2>
    <h3>ุฅุถุงูุฉ ุตูู ุฌุฏูุฏ</h3>
         <input type="text" id="item-name" placeholder="ุงุณู ุงูุตูู">
     <input type="number" id="item-price" placeholder="ุงูุณุนุฑ ุจุงููุจูุงูู">
     <input type="text" id="item-features" placeholder="ุงูุฎุตุงุฆุต (ููุตููุฉ ุจูุณุงูุฉ ูุงุญุฏุฉุ ูุซุงู: ุทูุงุทู ูุงุชุดุงุจ ุจุทุงุทุง)">
    <button onclick="addItem()">๐พ ุญูุธ ุงูุตูู</button>
    <button onclick="showOrderInterface()" class="secondary-btn">โ ุงูุนูุฏุฉ ููุทูุจุงุช</button>
  `;
}

// ุฅุถุงูุฉ ุตูู ุฌุฏูุฏ
function addItem() {
  const name = document.getElementById("item-name").value;
  const price = parseInt(document.getElementById("item-price").value);
  const featuresText = document.getElementById("item-features").value;
  
  if (name && price > 0) {
    // ุชุญููู ุงููุต ุฅูู ูุตูููุฉ ุฎุตุงุฆุต
    const features = featuresText.trim() ? featuresText.split(' ').filter(f => f.trim()) : [];
    
    const newItem = {
      id: Date.now(),
      name: name,
      price: price,
      features: features
    };
    
    items.push(newItem);
    saveAllData();
    
    // ูุณุญ ุงูุญููู
    document.getElementById("item-name").value = "";
    document.getElementById("item-price").value = "";
    document.getElementById("item-features").value = "";
    
    showNotification("ุชูุช ุฅุถุงูุฉ ุงูุตูู ุจูุฌุงุญ! ุฌููุน QR Codes ูุญุฏุซุฉ ุชููุงุฆูุงู", "success");
    
    // ุญูุธ ุชููุงุฆู ูู 5 ุฏูุงุฆู
    setTimeout(() => {
      saveAllData();
    }, 300000);
  } else {
    showNotification("ูุฑุฌู ุฅุฏุฎุงู ุงุณู ูุณุนุฑ ุตุญูุญ.", "error");
  }
}

// ุนุฑุถ ูุงุฌูุฉ ุฅุฏุงุฑุฉ ุงูุทูุจุงุช
function showOrderInterface() {
  const content = document.getElementById("main-content");
  content.innerHTML = `
    <h2>Sardecoffeshop</h2>
    <h3>ุฅุฏุงุฑุฉ ุงูุทูุจุงุช</h3>
    
    <div class="admin-controls">
      <input type="text" id="search-box" oninput="filterItems()" placeholder="ุงุจุญุซ ุนู ุตูู...">
      <button onclick="generateOrderLink()" class="generate-link-btn">๐ ุชูููุฏ ุฑุงุจุท ุงูุทูุจ</button>
    </div>
    
    <div id="items-list"></div>
    
    <div class="selected-items" id="selected-items">
      <h3>ุงูุทูุจ ุงูุญุงูู</h3>
      <div id="order-preview"></div>
      <div class="total-display" id="total-display">ุงููุฌููุน ุงูููู: 0 ู.ู</div>
      
      <div class="order-actions">
        <button onclick="printOrder()">๐จ๏ธ ุทุจุงุนุฉ ุงูุทูุจูุฉ</button>
        <button onclick="clearOrder()" class="clear-btn">๐๏ธ ูุณุญ ุงูุทูุจ</button>
      </div>
    </div>
    
    <div class="data-management">
      <h3>ุฅุฏุงุฑุฉ ุงูุจูุงูุงุช</h3>
      <div class="data-actions">
        <button onclick="exportData()" class="export-btn">๐ค ุชุตุฏูุฑ ุงูุจูุงูุงุช</button>
        <button onclick="importData()" class="import-btn">๐ฅ ุงุณุชูุฑุงุฏ ุงูุจูุงูุงุช</button>
      </div>
    </div>
  `;
  renderItems();
}

// ุนุฑุถ ูุงุฌูุฉ ุฅุฏุงุฑุฉ ุงูุทุงููุงุช
function showTablesInterface() {
  console.log("ุชู ุงุณุชุฏุนุงุก showTablesInterface");
  const content = document.getElementById("main-content");
  console.log("ุนูุตุฑ main-content:", content);
  
  content.innerHTML = `
    <h2>Sardecoffeshop</h2>
    <h3>ุฅุฏุงุฑุฉ ุงูุทุงููุงุช</h3>
    
    <div class="system-stats">
      <div class="stat-card">
        <h4>ุงูุฃุตูุงู</h4>
        <span class="stat-number">${items.length}</span>
      </div>
      <div class="stat-card">
        <h4>ุงูุทุงููุงุช</h4>
        <span class="stat-number">${tables.length}</span>
      </div>
      <div class="stat-card">
        <h4>ุงูุทูุจุงุช ุงููุดุทุฉ</h4>
        <span class="stat-number">${orders.filter(o => o.status === 'pending').length}</span>
      </div>
      <div class="stat-card">
        <h4>ุงูุทุงููุงุช ุงููุดุทุฉ</h4>
        <span class="stat-number">${tables.filter(t => t.active).length}</span>
      </div>
    </div>
    
    <div class="tables-grid" id="tables-grid"></div>
    
    <div class="table-actions">
      <button onclick="addNewTable()" class="add-table-btn">โ ุฅุถุงูุฉ ุทุงููุฉ ุฌุฏูุฏุฉ</button>
      <button onclick="showKitchenLink()" class="kitchen-btn">๐จโ๐ณ ุฑุงุจุท ุงููุทุจุฎ</button>
    </div>
  `;
  
  console.log("ุชู ุฅูุดุงุก HTML ูููุงุฌูุฉุ ุงูุขู ุณูุชู ุงุณุชุฏุนุงุก renderTables");
  renderTables();
}

// ุฏุงูุฉ ุทุจุงุนุฉ QR ููุทุงููุฉ
function printTableQR(tableId) {
  const table = tables.find(t => t.id === tableId);
  if (!table) return;
  
  const printWindow = window.open('', '_blank');
  printWindow.document.write(`
    <!DOCTYPE html>
    <html dir="rtl">
    <head>
      <meta charset="UTF-8">
      <title>ุทุจุงุนุฉ QR - ${table.name}</title>
      <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
      <style>
        @media print {
          body { margin: 0; padding: 15px; }
          .qr-container { text-align: center; page-break-inside: avoid; }
          .brand-title { font-size: 28px; font-weight: 600; margin-bottom: 8px; color: #b38728; }
          .brand-subtitle { font-size: 18px; font-weight: 400; margin-bottom: 15px; color: #8e44ad; }
          .table-name { font-size: 20px; font-weight: 600; margin-bottom: 20px; color: #2c3e50; }
          .qr-code { margin: 15px auto; }
          .qr-instruction { font-size: 14px; color: #34495e; margin-top: 12px; }
          .logo-placeholder { width: 60px; height: 60px; margin: 0 auto 15px; background: #f8f9fa; border: 2px dashed #dee2e6; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
        }
        body { 
          font-family: 'Cairo', 'Poppins', sans-serif; 
          background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
          margin: 0;
          padding: 20px;
          min-height: 100vh;
        }
        .qr-container { 
          text-align: center; 
          padding: 30px; 
          background: white;
          border-radius: 15px;
          box-shadow: 0 4px 20px rgba(0,0,0,0.1);
          max-width: 400px;
          margin: 0 auto;
        }
        .brand-title { 
          font-size: 32px; 
          font-weight: 600; 
          margin-bottom: 5px; 
          color: #b38728;
          font-family: 'Cairo', sans-serif;
        }
        .brand-subtitle { 
          font-size: 20px; 
          font-weight: 400; 
          margin-bottom: 20px; 
          color: #8e44ad;
          font-family: 'Cairo', sans-serif;
        }
        .table-name { 
          font-size: 24px; 
          font-weight: 600; 
          margin-bottom: 25px; 
          color: #2c3e50;
          font-family: 'Poppins', sans-serif;
          background: linear-gradient(135deg, #3498db, #2980b9);
          color: white;
          padding: 10px 20px;
          border-radius: 25px;
          display: inline-block;
        }
        .qr-code { 
          margin: 20px auto; 
          padding: 15px;
          background: white;
          border-radius: 12px;
          box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .qr-instruction { 
          font-size: 16px; 
          color: #34495e; 
          margin-top: 20px;
          font-weight: 500;
          padding: 10px;
          background: #f8f9fa;
          border-radius: 8px;
          border-right: 4px solid #3498db;
        }
        .logo-placeholder { 
          width: 80px; 
          height: 80px; 
          margin: 0 auto 20px; 
          background: linear-gradient(135deg, #b38728, #8e44ad);
          border-radius: 50%; 
          display: flex; 
          align-items: center; 
          justify-content: center;
          color: white;
          font-size: 24px;
          font-weight: bold;
        }
        @media print {
          body { background: white; }
          .qr-container { box-shadow: none; border: 1px solid #dee2e6; }
        }
      </style>
    </head>
    <body>
      <div class="qr-container">
        <div class="logo-placeholder">S</div>
        <div class="brand-title">Sardรฉ</div>
        <div class="brand-subtitle">ุณุฑุฏุฉ</div>
        <div class="table-name">${table.name}</div>
        <div class="qr-code">
          <img src="https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodeURIComponent(table.qrCode)}" 
               alt="QR Code for ${table.name}" style="border: 2px solid #3498db; border-radius: 10px;" />
        </div>
        <div class="qr-instruction">ุงูุณุญ ูุฐุง ุงูููุฏ ููุทูุจ ูู ุทุงููุชู</div>
      </div>
    </body>
    </html>
  `);
  printWindow.document.close();
  printWindow.print();
}

// ุนุฑุถ ุงูุทุงููุงุช
function renderTables() {
  const grid = document.getElementById("tables-grid");
  console.log("ุงูุจุญุซ ุนู ุนูุตุฑ tables-grid:", grid);
  if (!grid) {
    console.error("ูู ูุชู ุงูุนุซูุฑ ุนูู ุนูุตุฑ tables-grid!");
    return;
  }
  
  grid.innerHTML = "";
  
  console.log("ุนุฏุฏ ุงูุทุงููุงุช:", tables.length);
  console.log("ูุญุชูู ูุตูููุฉ ุงูุทุงููุงุช:", tables);
  
  tables.forEach((table, index) => {
    console.log(`ูุนุงูุฌุฉ ุงูุทุงููุฉ ${index + 1}:`, table);
    const tableCard = document.createElement("div");
    tableCard.className = `table-card ${table.active ? 'active' : ''}`;
    tableCard.innerHTML = `
      <h3>${table.name}</h3>
      <div class="table-status">
        <span class="status-indicator ${table.active ? 'active' : ''}"></span>
        ${table.active ? 'ูุดุทุฉ' : 'ุบูุฑ ูุดุทุฉ'}
      </div>
      <div class="table-qr">
        <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodeURIComponent(table.qrCode)}" 
             alt="QR Code for ${table.name}" />
      </div>
      <div class="table-actions">
        <button onclick="toggleTableStatus(${table.id})" class="toggle-btn">
          ${table.active ? 'ุฅููุงู' : 'ุชูุนูู'}
        </button>
        <button onclick="printTableQR(${table.id})" class="print-btn">๐จ๏ธ ุทุจุงุนุฉ</button>
        <button onclick="deleteTable(${table.id})" class="delete-btn">๐๏ธ ุญุฐู</button>
      </div>
    `;
    grid.appendChild(tableCard);
    console.log("ุชู ุฅุถุงูุฉ ุทุงููุฉ:", table.name, "ูุน ุฒุฑ ุงูุทุจุงุนุฉ");
  });
  
  console.log("ุงูุชูู ุนุฑุถ ุงูุทุงููุงุช. ุนุฏุฏ ุงูุนูุงุตุฑ ูู ุงูุฌุฏูู:", grid.children.length);
}

// ุฅุถุงูุฉ ุทุงููุฉ ุฌุฏูุฏุฉ
function addNewTable() {
  const newTableId = Math.max(...tables.map(t => t.id), 0) + 1;
  const newTable = {
    id: newTableId,
    name: `Table ${newTableId}`,
    qrCode: generateQRCode(newTableId),
    active: false
  };
  
  tables.push(newTable);
  saveAllData();
  renderTables();
  showNotification("ุชูุช ุฅุถุงูุฉ ุงูุทุงููุฉ ุจูุฌุงุญ! QR Code ูุญุฏุซ ุชููุงุฆูุงู", "success");
  
  // ุฅุถุงูุฉ ุทุงููุฉ ุชุฌุฑูุจูุฉ ููุชุฃูุฏ ูู ุธููุฑ ุฒุฑ ุงูุทุจุงุนุฉ
  console.log("ุชู ุฅุถุงูุฉ ุทุงููุฉ ุฌุฏูุฏุฉ:", newTable);
  console.log("ุฒุฑ ุงูุทุจุงุนุฉ ููุฌูุฏ ูู ุงูููุฏ");
}

// ุชุจุฏูู ุญุงูุฉ ุงูุทุงููุฉ
function toggleTableStatus(tableId) {
  const table = tables.find(t => t.id === tableId);
  if (table) {
    table.active = !table.active;
    saveAllData();
    renderTables();
    showNotification(`ุชู ${table.active ? 'ุชูุนูู' : 'ุฅููุงู'} ุงูุทุงููุฉ ${table.name}`, "success");
  }
}

// ุญุฐู ุทุงููุฉ
function deleteTable(tableId) {
  if (confirm("ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐู ุงูุทุงููุฉุ")) {
    tables = tables.filter(t => t.id !== tableId);
    saveAllData();
    renderTables();
    showNotification("ุชู ุญุฐู ุงูุทุงููุฉ ุจูุฌุงุญ!", "success");
  }
}

// ุนุฑุถ ุฑุงุจุท ุงููุทุจุฎ
function showKitchenLink() {
  const kitchenUrl = `${window.location.origin}${window.location.pathname.replace('index.html', 'kitchen.html')}`;
  
  // ูุชุญ ุตูุญุฉ ุงููุทุจุฎ ูู ูุงูุฐุฉ ุฌุฏูุฏุฉ
  window.open(kitchenUrl, '_blank');
  
  showNotification("ุชู ูุชุญ ุตูุญุฉ ุงููุทุจุฎ ูู ูุงูุฐุฉ ุฌุฏูุฏุฉ!", "success");
}

// ุชุตุฏูุฑ ุงูุจูุงูุงุช
function exportData() {
  const data = {
    items: items,
    tables: tables,
    orders: orders,
    exportDate: new Date().toISOString()
  };
  
  const dataStr = JSON.stringify(data, null, 2);
  const dataBlob = new Blob([dataStr], {type: 'application/json'});
  
  const link = document.createElement('a');
  link.href = URL.createObjectURL(dataBlob);
  link.download = `cave-restaurant-data-${new Date().toISOString().split('T')[0]}.json`;
  link.click();
  
  showNotification("ุชู ุชุตุฏูุฑ ุงูุจูุงูุงุช ุจูุฌุงุญ!", "success");
}

// ุงุณุชูุฑุงุฏ ุงูุจูุงูุงุช
function importData() {
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = '.json';
  
  input.onchange = function(e) {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const data = JSON.parse(e.target.result);
          
          if (data.items) items = data.items;
          if (data.tables) tables = data.tables;
          if (data.orders) orders = data.orders;
          
          saveAllData();
          showNotification("ุชู ุงุณุชูุฑุงุฏ ุงูุจูุงูุงุช ุจูุฌุงุญ!", "success");
          
          // ุฅุนุงุฏุฉ ุชุญููู ุงููุงุฌูุฉ
          if (document.getElementById("main-content")) {
            showOrderInterface();
          }
        } catch (error) {
          showNotification("ุฎุทุฃ ูู ูุฑุงุกุฉ ุงูููู!", "error");
        }
      };
      reader.readAsText(file);
    }
  };
  
  input.click();
}

// ุนุฑุถ ูุงุฌูุฉ ุงูุทูุจ ููุทุงููุฉ
function showTableCustomerInterface(tableId) {
  currentTable = tableId;
  const table = tables.find(t => t.id === tableId);
  
  // ุฅุฎูุงุก ุงูุดุฑูุท ุงูุฌุงูุจู
  const sidebar = document.querySelector('.sidebar');
  if (sidebar) sidebar.style.display = 'none';
  
  const content = document.getElementById("main-content");
  content.innerHTML = `
    <div class="customer-header">
      <div class="restaurant-brand">
        <h1 class="brand-title">Sardรฉ</h1>
        <h2 class="brand-subtitle">ุณุฑุฏุฉ</h2>
        <div class="brand-divider"></div>
      </div>
      <div class="table-info">
        <h3>ูุฑุญุจุงู ุจู ูู ${table ? table.name : `ุงูุทุงููุฉ ${tableId}`}!</h3>
        <p>ุงุฎุชุฑ ูู ูุงุฆูุฉ ุทุนุงููุง ุงูุดููุฉ</p>
      </div>
    </div>
    
    <div class="customer-interface">
      <div class="menu-section">
        <h3>๐ ูุงุฆูุฉ ุงูุทุนุงู</h3>
        <input type="text" id="search-box" oninput="filterCustomerItems()" placeholder="ุงุจุญุซ ุนู ุตูู...">
        <div id="customer-items-list"></div>
      </div>
      
      <div class="order-section">
        <h3>๐ ุทูุจู</h3>
        <div id="customer-order-preview"></div>
        <div class="total-display" id="customer-total">ุงููุฌููุน ุงูููู: 0 ู.ู</div>
        
        <div class="customer-info">
          <h4>ููุงุญุธุงุช ุฎุงุตุฉ</h4>
          <textarea id="customer-notes" placeholder="ุงูุชุจ ููุงุญุธุงุชู ููุง (ูุซู: ุจุฏูู ููุญุ ุฒูุงุฏุฉ ุตูุตุ ุนูุฏ ูููุงุฏ...)" class="customer-input"></textarea>
        </div>
        
        <div class="order-actions">
          <button onclick="sendTableOrder()" class="send-order-btn">๐ค ุฅุฑุณุงู ุงูุทูุจูุฉ</button>
          <button onclick="clearCustomerOrder()" class="clear-btn">๐๏ธ ูุณุญ ุงูุทูุจ</button>
          <button onclick="requestService()" class="service-btn">๐ ุทูุจ ูุฑุงุฌุนุฉ</button>
        </div>
      </div>
    </div>
  `;
  
  selectedItems = [];
  renderCustomerItems();
}

// ุฅุฑุณุงู ุทูุจ ุงูุทุงููุฉ
function sendTableOrder() {
  if (selectedItems.length === 0) {
    showNotification("ูุฑุฌู ุงุฎุชูุงุฑ ุฃุตูุงู ููุทูุจ ุฃููุงู", "warning");
    return;
  }
  
  const notes = document.getElementById("customer-notes")?.value || "";
  
  // ุชูุณูู ุงูุทูุจ ุญุณุจ ุงููุทููุจ
  const order = {
    id: Date.now(),
    table: currentTable,
    items: selectedItems.map(item => ({
      name: item.name,
      quantity: item.quantity,
      options: item.selectedFeatures || []
    })),
    note: notes,
    status: 'new',
    time: new Date().toISOString().slice(0, 19).replace('T', ' ')
  };
  
  // ุญูุธ ุงูุทูุจ ูู localStorage
  const existingOrders = JSON.parse(localStorage.getItem('restaurantOrders') || '[]');
  existingOrders.push(order);
  localStorage.setItem('restaurantOrders', JSON.stringify(existingOrders));
  
  // ุญูุธ ูู orders array ููุชูุงูู ูุน ุงููุธุงู ุงูุญุงูู
  orders.push({
    ...order,
    tableId: currentTable,
    timestamp: new Date().toISOString(),
    total: selectedItems.reduce((sum, item) => sum + (item.price * item.quantity), 0)
  });
  saveAllData();
  
  // ุชูุนูู ุงูุทุงููุฉ
  const table = tables.find(t => t.id === currentTable);
  if (table) {
    table.active = true;
    saveAllData();
  }
  
  showNotification("ุชู ุฅุฑุณุงู ุทูุจู ุจูุฌุงุญ! ุณูุชู ุชุญุถูุฑู ูุฑูุจุงู", "success");
  
  // ูุณุญ ุงูุทูุจ
  selectedItems = [];
  renderCustomerOrder();
  document.getElementById("customer-notes").value = "";
  
  // ุฅูุบุงุก ุชุญุฏูุฏ ุฌููุน ุงูุตูุงุฏูู
  document.querySelectorAll('#customer-items-list input[type="checkbox"]').forEach(cb => {
    cb.checked = false;
  });
}



// ุทูุจ ูุฑุงุฌุนุฉ
function requestService() {
  if (!currentTable) {
    showNotification("ูุง ูููู ุทูุจ ูุฑุงุฌุนุฉ ุจุฏูู ุทุงููุฉ", "error");
    return;
  }
  
  const serviceRequest = {
    id: Date.now(),
    tableId: currentTable,
    type: 'service',
    timestamp: new Date().toISOString(),
    message: `ุทูุจ ูุฑุงุฌุนุฉ ูู ุงูุทุงููุฉ ${currentTable}`
  };
  
  // ุญูุธ ุทูุจ ุงููุฑุงุฌุนุฉ
  const serviceRequests = JSON.parse(localStorage.getItem('serviceRequests') || '[]');
  serviceRequests.push(serviceRequest);
  localStorage.setItem('serviceRequests', JSON.stringify(serviceRequests));
  
  showNotification("ุชู ุฅุฑุณุงู ุทูุจ ุงููุฑุงุฌุนุฉ! ุณูุฃุชู ุฃุญุฏ ุงูููุธููู ูุฑูุจุงู", "success");
}

// ุนุฑุถ ูุงุฌูุฉ ุงููุทุจุฎ
function showKitchenInterface() {
  // ุชูุฌูู ุงููุณุชุฎุฏู ุฅูู ุตูุญุฉ ุงููุทุจุฎ ุงููููุตูุฉ
  const kitchenUrl = `${window.location.origin}${window.location.pathname.replace('index.html', 'kitchen.html')}`;
  window.open(kitchenUrl, '_blank');
  showNotification("ุชู ูุชุญ ุตูุญุฉ ุงููุทุจุฎ ูู ูุงูุฐุฉ ุฌุฏูุฏุฉ!", "success");
}



// ุชูููุฏ ุฑุงุจุท ุงูุทูุจ ููุฒุจูู
function generateOrderLink() {
  if (items.length === 0) {
    showNotification("ูุง ุชูุฌุฏ ุฃุตูุงู ูุชุงุญุฉ. ูุฑุฌู ุฅุถุงูุฉ ุฃุตูุงู ุฃููุงู.", "warning");
    return;
  }
  
  const orderData = encodeURIComponent(JSON.stringify(items));
  const orderUrl = `${window.location.origin}${window.location.pathname}?order=${orderData}`;
  
  // ูุณุฎ ุงูุฑุงุจุท ููุญุงูุธุฉ
  navigator.clipboard.writeText(orderUrl).then(() => {
    showNotification("ุชู ูุณุฎ ุฑุงุจุท ุงูุทูุจ! ููููู ุงูุขู ุฅุฑุณุงูู ููุฒุจูู.", "success");
  }).catch(() => {
    // ุฅุฐุง ูุดู ุงููุณุฎ ุงูุชููุงุฆูุ ุงุนุฑุถ ุงูุฑุงุจุท ูู ูุฑุจุน ุญูุงุฑ
    const copiedUrl = prompt("ุฑุงุจุท ุงูุทูุจ (ุงูุณุฎู ูุฏููุงู):", orderUrl);
    if (copiedUrl) {
      showNotification("ุชู ูุณุฎ ุงูุฑุงุจุท ุจูุฌุงุญ!", "success");
    }
  });
}

// ุนุฑุถ ูุงุฌูุฉ ุงูุฒุจูู
function showCustomerInterface(orderItems) {
  // ุฅุฎูุงุก ุงูุดุฑูุท ุงูุฌุงูุจู
  const sidebar = document.querySelector('.sidebar');
  if (sidebar) sidebar.style.display = 'none';
  
  const content = document.getElementById("main-content");
  content.innerHTML = `
    <div class="customer-header">
      <div class="restaurant-brand">
        <h1 class="brand-title">Sardรฉ</h1>
        <h2 class="brand-subtitle">ุณุฑุฏุฉ</h2>
        <div class="brand-divider"></div>
      </div>
      <div class="table-info">
        <h3>ูุฑุญุจุงู ุจู!</h3>
        <p>ุงุฎุชุฑ ูู ูุงุฆูุฉ ุทุนุงููุง ุงูุดููุฉ</p>
      </div>
    </div>
    
    <div class="customer-interface">
      <div class="menu-section">
        <h3>๐ ูุงุฆูุฉ ุงูุทุนุงู</h3>
        <input type="text" id="search-box" oninput="filterCustomerItems()" placeholder="ุงุจุญุซ ุนู ุตูู...">
        <div id="customer-items-list"></div>
      </div>
      
      <div class="order-section">
        <h3>๐ ุทูุจู</h3>
        <div id="customer-order-preview"></div>
        <div class="total-display" id="customer-total">ุงููุฌููุน ุงูููู: 0 ู.ู</div>
        
        <div class="customer-info">
          <h4>ูุนูููุงุช ุงูุชูุตูู</h4>
          <input type="text" id="customer-name" placeholder="ุงุณูู" class="customer-input" required>
          <input type="text" id="customer-address" placeholder="ุนููุงูู" class="customer-input" required>
          <input type="tel" id="customer-phone" placeholder="ุฑูู ุงููุงุชู" class="customer-input">
        </div>
        
                 <div class="order-actions">
           <button onclick="sendCustomerOrder()" class="send-order-btn">๐ค ุฅุฑุณุงู ุงูุทูุจูุฉ</button>
           <button onclick="clearCustomerOrder()" class="clear-btn">๐๏ธ ูุณุญ ุงูุทูุจ</button>
         </div>
      </div>
    </div>
  `;
  
  // ุชุนููู ุงูุฃุตูุงู ููุนุฑุถ
  items = orderItems;
  selectedItems = [];
  renderCustomerItems();
}

// ุนุฑุถ ุงูุฃุตูุงู ููุฒุจูู
function renderCustomerItems(list = items) {
  const listContainer = document.getElementById("customer-items-list");
  if (!listContainer) return;
  
  listContainer.innerHTML = "";

  if (list.length === 0) {
    listContainer.innerHTML = "<p class=\"no-items\">ูุง ุชูุฌุฏ ุฃุตูุงู ูุชุงุญุฉ</p>";
    return;
  }

  list.forEach((item, index) => {
    const id = `customer-item-${index}`;
    const box = document.createElement("div");
    box.className = "customer-item-box";
    box.innerHTML = `
      <div class="item-info">
        <input type="checkbox" id="${id}" onchange="toggleCustomerItem(${index}, this.checked)">
        <label for="${id}">
          <span class="item-name">${item.name}</span>
          <span class="item-price">${item.price.toLocaleString()} ู.ู</span>
        </label>
      </div>
      ${item.features && item.features.length > 0 ? `
        <div class="features-section">
          <p class="features-title">ุงุฎุชุฑ ุงูุฎุตุงุฆุต:</p>
          <div class="features-list">
            ${item.features.map((feature, featureIndex) => `
              <label class="feature-checkbox">
                <input type="checkbox" id="feature-${index}-${featureIndex}" 
                       onchange="updateItemFeatures(${index}, '${feature}', this.checked)">
                <span>${feature}</span>
              </label>
            `).join('')}
          </div>
        </div>
      ` : ''}
    `;
    listContainer.appendChild(box);
  });
}

// ููุชุฑุฉ ุงูุฃุตูุงู ููุฒุจูู
function filterCustomerItems() {
  const search = document.getElementById("search-box").value.toLowerCase();
  const filtered = items.filter(i => i.name.toLowerCase().includes(search));
  renderCustomerItems(filtered);
}

// ุฅุถุงูุฉ/ุฅุฒุงูุฉ ุตูู ูู ุทูุจ ุงูุฒุจูู
function toggleCustomerItem(index, checked) {
  const item = items[index];
  if (checked) {
    selectedItems.push({ ...item, quantity: 1 });
  } else {
    selectedItems = selectedItems.filter(i => i.id !== item.id);
  }
  renderCustomerOrder();
}

// ุนุฑุถ ุทูุจ ุงูุฒุจูู
function renderCustomerOrder() {
  const container = document.getElementById("customer-order-preview");
  if (!container) return;
  
  container.innerHTML = "";

  if (selectedItems.length === 0) {
    container.innerHTML = "<p class=\"empty-order\">ูู ุชุฎุชุฑ ุฃู ุฃุตูุงู ุจุนุฏ</p>";
    document.getElementById("customer-total").innerText = "ุงููุฌููุน ุงูููู: 0 ู.ู";
    return;
  }

  selectedItems.forEach((item, idx) => {
    const row = document.createElement("div");
    row.className = "order-item-row";
    row.innerHTML = `
      <div class="item-details">
        <span class="item-name">${item.name}</span>
        <span class="item-price">${item.price.toLocaleString()} ู.ู</span>
      </div>
      <div class="quantity-controls">
        <button onclick="updateCustomerQty(${idx}, ${item.quantity - 1})" class="qty-btn">-</button>
        <span class="qty-display">${item.quantity}</span>
        <button onclick="updateCustomerQty(${idx}, ${item.quantity + 1})" class="qty-btn">+</button>
      </div>
    `;
    container.appendChild(row);
  });

  calculateCustomerTotal();
}

// ุชุญุฏูุซ ูููุฉ ุตูู ูู ุทูุจ ุงูุฒุจูู
function updateCustomerQty(index, newQty) {
  if (newQty < 1) {
    selectedItems.splice(index, 1);
  } else {
    selectedItems[index].quantity = newQty;
  }
  renderCustomerOrder();
}

// ุญุณุงุจ ุงููุฌููุน ููุฒุจูู
function calculateCustomerTotal() {
  let total = 0;
  selectedItems.forEach(item => {
    total += item.price * item.quantity;
  });
  document.getElementById("customer-total").innerText = "ุงููุฌููุน ุงูููู: " + total.toLocaleString() + " ู.ู";
}

// ุฅุฑุณุงู ุทูุจ ุงูุฒุจูู ุนุจุฑ ูุงุชุณุงุจ
function sendCustomerOrder() {
  const customerName = document.getElementById("customer-name")?.value;
  const customerAddress = document.getElementById("customer-address")?.value;
  const customerPhone = document.getElementById("customer-phone")?.value;
  
  if (selectedItems.length === 0) {
    showNotification("ูุฑุฌู ุงุฎุชูุงุฑ ุฃุตูุงู ููุทูุจ ุฃููุงู", "warning");
    return;
  }
  
  if (!customerName || !customerAddress) {
    showNotification("ูุฑุฌู ุฅุฏุฎุงู ุงูุงุณู ูุงูุนููุงู", "error");
    return;
  }
  
  // ุชูุณูู ุงูุทูุจ ุญุณุจ ุงููุทููุจ
  const order = {
    id: Date.now(),
    table: 0, // ุทูุจ ุฎุงุฑุฌู
    items: selectedItems.map(item => ({
      name: item.name,
      quantity: item.quantity,
      options: item.selectedFeatures || []
    })),
    note: `ุงุณู ุงูุฒุจูู: ${customerName} | ุงูุนููุงู: ${customerAddress}${customerPhone ? ` | ุงููุงุชู: ${customerPhone}` : ''}`,
    status: 'new',
    time: new Date().toISOString().slice(0, 19).replace('T', ' ')
  };
  
  // ุญูุธ ุงูุทูุจ ูู localStorage
  const existingOrders = JSON.parse(localStorage.getItem('restaurantOrders') || '[]');
  existingOrders.push(order);
  localStorage.setItem('restaurantOrders', JSON.stringify(existingOrders));
  
  // ุญูุธ ูู orders array ููุชูุงูู ูุน ุงููุธุงู ุงูุญุงูู
  orders.push({
    ...order,
    tableId: 0,
    timestamp: new Date().toISOString(),
    total: selectedItems.reduce((sum, item) => sum + (item.price * item.quantity), 0)
  });
  saveAllData();
  
  showNotification("ุชู ุฅุฑุณุงู ุทูุจู ุจูุฌุงุญ! ุณูุชู ุงูุชูุงุตู ูุนูู ูุฑูุจุงู", "success");
  
  // ูุณุญ ุงูุทูุจ
  selectedItems = [];
  renderCustomerOrder();
  
  // ูุณุญ ุงูุจูุงูุงุช ุงููุฏุฎูุฉ
  document.getElementById("customer-name").value = "";
  document.getElementById("customer-address").value = "";
  document.getElementById("customer-phone").value = "";
  
  // ุฅูุบุงุก ุชุญุฏูุฏ ุฌููุน ุงูุตูุงุฏูู
  document.querySelectorAll('#customer-items-list input[type="checkbox"]').forEach(cb => {
    cb.checked = false;
  });
}

// ุชุญุฏูุซ ุฎุตุงุฆุต ุงูุตูู ุงููุญุฏุฏ
function updateItemFeatures(itemIndex, feature, checked) {
  const item = selectedItems.find(i => i.id === items[itemIndex].id);
  if (item) {
    if (!item.selectedFeatures) {
      item.selectedFeatures = [];
    }
    
    if (checked) {
      if (!item.selectedFeatures.includes(feature)) {
        item.selectedFeatures.push(feature);
      }
    } else {
      item.selectedFeatures = item.selectedFeatures.filter(f => f !== feature);
    }
  }
}

// ูุณุญ ุทูุจ ุงูุฒุจูู
function clearCustomerOrder() {
  selectedItems = [];
  renderCustomerOrder();
  // ุฅูุบุงุก ุชุญุฏูุฏ ุฌููุน ุงูุตูุงุฏูู
  document.querySelectorAll('#customer-items-list input[type="checkbox"]').forEach(cb => {
    cb.checked = false;
  });
}

// ููุชุฑุฉ ุงูุฃุตูุงู ูู ูุงุฌูุฉ ุงูุฅุฏุงุฑุฉ
function filterItems() {
  const search = document.getElementById("search-box").value.toLowerCase();
  const filtered = items.filter(i => i.name.toLowerCase().includes(search));
  renderItems(filtered);
}

// ุนุฑุถ ุงูุฃุตูุงู ูู ูุงุฌูุฉ ุงูุฅุฏุงุฑุฉ
function renderItems(list = items) {
  const listContainer = document.getElementById("items-list");
  if (!listContainer) return;
  
  listContainer.innerHTML = "";

  if (list.length === 0) {
    listContainer.innerHTML = "<p class=\"no-items\">ูุง ุชูุฌุฏ ุฃุตูุงู</p>";
    return;
  }

  list.forEach((item, index) => {
    const id = `item-${index}`;
    const box = document.createElement("div");
    box.className = "item-box";
    box.innerHTML = `
      <div class="item-info">
        <input type="checkbox" id="${id}" onchange="toggleItem(${index}, this.checked)">
        <label for="${id}">
          <span class="item-name">${item.name}</span>
          <span class="item-price">${item.price.toLocaleString()} ู.ู</span>
        </label>
      </div>
      ${item.features && item.features.length > 0 ? `<p class="item-features">ุงูุฎุตุงุฆุต: ${item.features.join(', ')}</p>` : ''}
      <button onclick="deleteItem(${index})" class="delete-btn">๐๏ธ ุญุฐู</button>
    `;
    listContainer.appendChild(box);
  });
}

// ุฅุถุงูุฉ/ุฅุฒุงูุฉ ุตูู ูู ุงูุทูุจ ูู ูุงุฌูุฉ ุงูุฅุฏุงุฑุฉ
function toggleItem(index, checked) {
  const item = items[index];
  if (checked) {
    selectedItems.push({ ...item, quantity: 1 });
  } else {
    selectedItems = selectedItems.filter(i => i.id !== item.id);
  }
  renderSelected();
}

// ุนุฑุถ ุงูุทูุจ ุงููุญุฏุฏ ูู ูุงุฌูุฉ ุงูุฅุฏุงุฑุฉ
function renderSelected() {
  const container = document.getElementById("order-preview");
  if (!container) return;
  
  container.innerHTML = "";

  selectedItems.forEach((item, idx) => {
    const row = document.createElement("div");
    row.className = "order-item-row";
    row.innerHTML = `
      <div class="item-details">
        <span class="item-name">${item.name}</span>
        <span class="item-price">${item.price.toLocaleString()} ู.ู</span>
      </div>
      <div class="quantity-controls">
        <button onclick="updateQty(${idx}, ${item.quantity - 1})" class="qty-btn">-</button>
        <span class="qty-display">${item.quantity}</span>
        <button onclick="updateQty(${idx}, ${item.quantity + 1})" class="qty-btn">+</button>
      </div>
    `;
    container.appendChild(row);
  });

  calculateTotal();
}

// ุชุญุฏูุซ ูููุฉ ูู ูุงุฌูุฉ ุงูุฅุฏุงุฑุฉ
function updateQty(index, newQty) {
  if (newQty < 1) {
    selectedItems.splice(index, 1);
  } else {
    selectedItems[index].quantity = newQty;
  }
  renderSelected();
}

// ุญุณุงุจ ุงููุฌููุน ูู ูุงุฌูุฉ ุงูุฅุฏุงุฑุฉ
function calculateTotal() {
  let total = 0;
  selectedItems.forEach(item => {
    total += item.price * item.quantity;
  });
  const totalDisplay = document.getElementById("total-display");
  if (totalDisplay) {
    totalDisplay.innerText = "ุงููุฌููุน ุงูููู: " + total.toLocaleString() + " ู.ู";
  }
}

// ุญุฐู ุตูู
function deleteItem(index) {
  if (confirm("ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐุง ุงูุตููุ")) {
    items.splice(index, 1);
    saveAllData();
    renderItems();
  }
}

// ูุณุญ ุงูุทูุจ ูู ูุงุฌูุฉ ุงูุฅุฏุงุฑุฉ
function clearOrder() {
  selectedItems = [];
  renderSelected();
  // ุฅูุบุงุก ุชุญุฏูุฏ ุฌููุน ุงูุตูุงุฏูู
  document.querySelectorAll('#items-list input[type="checkbox"]').forEach(cb => {
    cb.checked = false;
  });
}

// ุทุจุงุนุฉ ุงูุทูุจ
function printOrder() {
  if (selectedItems.length === 0) {
    showNotification("ูุง ุชูุฌุฏ ุฃุตูุงู ูุญุฏุฏุฉ ููุทุจุงุนุฉ", "warning");
    return;
  }
  
  let content = `CAVE RESTAURANT\n`;
  content += `โโโโโโโโโโโโโโโโโโโ\n\n`;
  content += `ุงูุชุงุฑูุฎ: ${new Date().toLocaleDateString('ar-LB')}\n`;
  content += `ุงูููุช: ${new Date().toLocaleTimeString('ar-LB')}\n`;
  content += `โโโโโโโโโโโโโโโโโโโ\n\n`;
  
  content += selectedItems.map(item =>
    `${item.name} ร ${item.quantity} = ${(item.price * item.quantity).toLocaleString()} ู.ู`
  ).join("\n");

  let total = selectedItems.reduce((sum, i) => sum + i.price * i.quantity, 0);
  content += "\n\nโโโโโโโโโโโโโโโโโโโ\n";
  content += "ุงููุฌููุน: " + total.toLocaleString() + " ู.ู";

  let win = window.open("", "", "height=700,width=900");
  win.document.write(`
  <html>
    <head>
      <style>
        body {
          font-size: 22px;
          font-family: 'Arial', sans-serif;
          direction: rtl;
          padding: 20px;
          text-align: center;
        }
        .restaurant-name {
          font-size: 28px;
          font-weight: bold;
          margin-bottom: 20px;
        }
        .divider {
          border-top: 2px solid #000;
          margin: 15px 0;
        }
      </style>
    </head>
    <body>
      <pre>${content}</pre>
    </body>
  </html>
`);
  win.print();
}